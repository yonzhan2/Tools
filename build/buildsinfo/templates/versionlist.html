{% load static %}
{% load common %}
<!DOCTYPE HTML>
<html lang="EN">
<head>
    <title>Version Info</title>
    <meta charset="utf-8">
    <meta content="telephone=no" name="format-detection">
    <link href="{% static 'favicon.ico' %}" rel="shortcut icon" type="image/x-icon">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    {% load bootstrap3 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <style>
    .table tbody tr td {
    vertical-align : middle;
    }

    .table thead tr th {
    text-align : center;
    }

    tr th {
        border-style: double;
    }

    tr td {
        border-style: double;
    }

    tr {
        border-style: double;
    }

    </style>
</head>

< role="document">
<!--nagavition -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="/version">Package Version CheckList</a>
        </div>
    </div>
</nav>

<!--VM Search List-->
<div class="page-header" style="padding-top: 10px;">
    <div class="navbar-collapse collapse" id="navbar">
        <form action="/version" class="navbar-form" method="get">
            <select class="form-control" name="env">
                <option value="">ENV</option>
                {% if search_env != '' %}
                <option selected value="{{ search_env }}">{{ search_env }}</option>
                {% endif %}
                {% for env in envs %}
                <option value="{{ env }}">{{ env }}</option>
                {% endfor %}


            </select>
            <div class="form-group">
                {% if search_name != '' %}
                <input class="form-control" name="hostname" placeholder="Host Name" type="text"
                       value="{{ search_name }}">
                {% else %}
                <input class="form-control" name="hostname" placeholder="Host Name" type="text">
                {% endif %}
                {% if search_ip != '' %}
                <input class="form-control" name="ipaddr" placeholder="Server IP" type="text" value="{{ search_ip }}">
                {% else %}
                <input class="form-control" name="ipaddr" placeholder="Server IP" type="text">
                {% endif %}
            </div>
            <button class="btn btn-success" type="submit">Search</button>
        </form>
        <!-- <p> {{search_env}},{{ search_name }},{{ search_ip }} </p>-->
    </div>
</div>

<!--VM List-->
<div class="row" style="padding-top: 10px;">
    <div class="col-sm-12">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>ENV</th>
                <th>Server Type</th>
                <th>HostName</th>
                <th>IP Addr</th>
                <th>Build Date</th>
                <th>Deploy Date</th>
                <th>Build Version</th>
                <th>Service Status</th>
                <!--<th>VMPath</th>-->
            </tr>
            </thead>
            <tbody>
            {% for build in buildsinfo %}
            <tr>
                <td align="center" rowspan="{{ build.build|length }}">{{ build.env }}</td>
                <td align="center" rowspan="{{ build.build|length }}">{{ build.type }}</td>
                <td align="center" rowspan="{{ build.build|length }}">{{ build.hostname }}</td>
                <td align="center" rowspan="{{ build.build|length }}">{{ build.ipaddr }}</td>
                {% if build.build|length == 1 %}
                <td colspan="1" rowspan="1">{{ build.build.0.1 }}</td>
                <td colspan="1" rowspan="1">{{ build.build.0.2 }}</td>
                {% if build.build.0.0 in build.lastbuild|first %}
                <td colspan="1" rowspan="1">{{ build.build.0.0 }}</td>

                {% else %}
                <td bgcolor="#50D050" colspan="1" rowspan="1">{{ build.build.0.0 }}</td>

                {% endif %}
                {% if build.status == "OKOKOK" %}
                <td align="center" rowspan="{{ build.build|length }} ">{{ build.status }}</td>
                {% else %}
                <td align="center" rowspan="{{ build.build|length }} "><font color="red">{{ build.status }}</font></td>
                {% endif %}
                {% elif build.build|length > 1 %}

                {% with firstbuild=build.build|slice:"1" %}
                <td colspan="1" rowspan="1">{{ firstbuild.0.1 }}</td>
                <td colspan="1" rowspan="1">{{ firstbuild.0.2 }}</td>
                {% if firstbuild.0.0 in build.lastbuild|first %}
                <td colspan="1" rowspan="1">{{ firstbuild.0.0 }}</td>
                {% else %}
                <td bgcolor="#50D050" colspan="1" rowspan="1">{{ firstbuild.0.0 }}</td>

                {% endif%}
                {% endwith %}

                {% if build.status == "OKOKOK" %}
                <td align="center" bgcolor="" rowspan="{{ build.build|length }} ">{{ build.status }}</td>
                {% else %}
                <td align="center" rowspan="{{ build.build|length }} "><font color="red">{{ build.status }}</font></td>
                {% endif %}
                {% for subbuild in build.build|slice:"1:" %}


            <tr>
                <td>{{ subbuild.1 }}</td>
                <td>{{ subbuild.2 }}</td>
                {% if subbuild.0 in lastbuild_list%}
                <td>{{ subbuild.0 }}</td>
                {% else %}
                <td bgcolor="#50D050">{{ subbuild.0 }}</td>
                {% endif %}
            </tr>
            {%endfor%}

            {% else %}
            <td colspan="1" rowspan="1">[]</td>
            <td colspan="1" rowspan="1">[]</td>
            <td colspan="1" rowspan="1">[]</td>
            <td align="center" rowspan="1 "> UNKNOW</td>
            {%endif%}

            </tr>

            {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<!--PagInator-->
<div class="pagination">
    <span class="step-links">
        {% if buildsinfo.has_previous %}

        <a href="{{ request.path }}?{{ search_env }}&{{ search_name }}&{{ search_ip }}&page={{ buildsinfo.previous_page_number }}">previous</a>
        {% endif %}
          <span class="current">
              Total: {{ count }}, Page {{ buildsinfo.number }} of {{ buildsinfo.paginator.num_pages }}.
          </span>
        {% if buildsinfo.has_next %}
        <a href="{{ request.path }}?{{ search_env }}&{{ search_name }}&{{ search_ip }}&page={{ buildsinfo.next_page_number }}">next</a>
        {% endif %}
    </span>
</div>
</body>
</html>

